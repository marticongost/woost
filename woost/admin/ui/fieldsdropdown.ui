<?xml version="1.0" encoding="utf-8"?>

<ui:cocktail.ui.ActionListDropdown
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="http://www.whads.com/ns/cocktail/ui">

    <ui:using mixin="cocktail.ui.DataDisplay"/>

    <?class
    actionSetup() {
        super.actionSetup();
        const context = this.getActionContext();
        this.checkList.dataBinding = {
            member: context.node.queryParameters.members,
            value: context.view.members
        };
        cocktail.ui.link(
            context.view,
            this.checkList,
            ["members", "value"],
            (view, checkList) => {
                checkList.value = view.members;
            },
            (checkList, view) => {
                // Changes to the check list are not applied until the 'Apply' button is clicked
            },
            // No need to set the value again
            false
        );
    }
    ?>

    <ui:with ui:element="dropdownPanel" footerVisible="true">

        <ui:cocktail.ui.CheckList
            id="checkList"
            sorted="true"
            selectionControlsVisible="true"
            searchable="true">

            <?on value:changed
            let value = this.value;
            let count = 0;
            if (value instanceof Array) {
                count = value.length;
            }
            else if (value instanceof Set) {
                count = value.size;
            }
            instance.applyButton.disabled = !count;
            ?>
        </ui:cocktail.ui.CheckList>

        <ui:cocktail.ui.Button id="applyButton" slot="footer">
            <ui:translation attribute="text"/>
            <?on click
            instance.dropdownPanel.expanded = false;
            instance.getActionContext().view.members = Array.from(instance.checkList.value);
            ?>
        </ui:cocktail.ui.Button>

    </ui:with>

</ui:cocktail.ui.ActionListDropdown>

